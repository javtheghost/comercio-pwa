<ion-header [translucent]="true">
  <ion-toolbar>
    @if (!showNextSteps) {
      <ion-buttons slot="start">
        <ion-button class="back-btn" fill="clear" (click)="goBackToNotifications()" aria-label="Volver a notificaciones" color="primary">
          <ion-icon name="arrow-back-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    }
    <ion-title>Orden Confirmada</ion-title>
  </ion-toolbar>
 </ion-header>

<ion-content [fullscreen]="true" class="has-footer-space" [class.has-many-items]="manyItems">
  <div class="confirmation-container">
    <ion-card class="success-card">
      <ion-card-content>
        <div class="success-hero">
          <div class="hero-badge">
            <ion-icon name="checkmark" class="badge-icon"></ion-icon>
          </div>
          <h1>¡Orden confirmada!</h1>
          <p class="order-id">N.º de orden <strong>#{{ order?.order_number || orderId }}</strong></p>
        </div>

        @if (order) {
          @if (showNextSteps) {
            <div class="next-steps">
              <h3>¿Qué sigue?</h3>
              <ul>
                <li>Te enviaremos un correo con el resumen de tu compra y el seguimiento.</li>
                <li>Puedes revisar el estado en <strong>Mis órdenes</strong> cuando quieras.</li>
              </ul>
              <div class="actions">
                <ion-button expand="block" (click)="goToOrders()">Ver mis órdenes</ion-button>
                <ion-button expand="block" fill="clear" (click)="goToHome()">Seguir comprando</ion-button>
              </div>
            </div>
          } @else {
            <div class="summary modern">
              <div class="row"><span>Subtotal</span><span>${{ order.subtotal | number:'1.2-2' }}</span></div>
              <div class="row"><span>IVA ({{ order.subtotal > 0 ? (order.tax_amount / order.subtotal * 100 | number:'1.0-0') : '16' }}%)</span><span>${{ order.tax_amount | number:'1.2-2' }}</span></div>
              <div class="row"><span>Envío</span><span>${{ order.shipping_amount | number:'1.2-2' }}</span></div>
              <div class="row total"><span>Total</span><span>${{ order.total_amount | number:'1.2-2' }}</span></div>
            </div>

            <ion-list class="items-list" *ngIf="(order?.items?.length || 0) > 0">
              <ion-item *ngFor="let item of order.items" lines="full">
                <ion-thumbnail slot="start">
                  <img [src]="getProductImage(item)" alt="Producto" (error)="onImgError($event)" />
                </ion-thumbnail>

                <ion-label>
                  <h3>{{ item.product?.name || 'Producto' }}</h3>
                  <p class="variant">{{ getVariantSummary(item) }}</p>
                </ion-label>

                <div slot="end" class="line-total">
                  ${{ item.total_price | number:'1.2-2' }}
                </div>
              </ion-item>
            </ion-list>
            

          }
        } @else if (loading) {
          <div class="next-steps">
            <ion-spinner name="crescent"></ion-spinner>
            <p>Cargando orden...</p>
          </div>
        } @else {
          <div class="next-steps">
            <h3>No se pudo cargar la orden</h3>
            <p>{{ error || 'Intenta de nuevo en un momento.' }}</p>
            <ion-button fill="outline" (click)="orderId && fetchOrder(+orderId)">Reintentar</ion-button>
          </div>
        }
      </ion-card-content>
    </ion-card>

    <!-- Acciones ocultas en contexto de notificaciones: solo mostrar detalle -->
  </div>
  
</ion-content>

<!-- Tabs Navigation (inline mode para solo mostrar la barra) -->
<app-tabs [inline]="true"></app-tabs>
