<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/profile"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <ion-icon name="location-outline" class="ion-margin-end"></ion-icon>
      {{ isEditing ? 'Editar Dirección' : 'Nueva Dirección' }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ isEditing ? 'Editar Dirección' : 'Nueva Dirección' }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando dirección...</p>
  </div>

  <!-- Formulario -->
  <ion-card *ngIf="!loading">
    <ion-card-content>
      <form (ngSubmit)="saveAddress()">
        <!-- Tipo de dirección -->
        <ion-item>
          <ion-label position="stacked">Tipo de Dirección *</ion-label>
          <ion-select
            [(ngModel)]="address.type"
            name="type"
            placeholder="Selecciona el tipo">
            <ion-select-option value="shipping">Envío</ion-select-option>
            <!-- <ion-select-option value="billing">Facturación</ion-select-option> -->
            <!-- <ion-select-option value="both">Envío y Facturación</ion-select-option> -->
          </ion-select>
        </ion-item>

        <!-- Nombre -->
        <ion-item>
          <ion-label position="stacked">Nombre *</ion-label>
          <ion-input
            [(ngModel)]="address.first_name"
            name="first_name"
            placeholder="Ingresa tu nombre"
            required>
          </ion-input>
        </ion-item>

        <!-- Apellido -->
        <ion-item>
          <ion-label position="stacked">Apellido *</ion-label>
          <ion-input
            [(ngModel)]="address.last_name"
            name="last_name"
            placeholder="Ingresa tu apellido"
            required>
          </ion-input>
        </ion-item>

        <!-- Dirección -->
        <ion-item>
          <ion-label position="stacked">Dirección *</ion-label>
          <ion-textarea
            [(ngModel)]="address.address_line_1"
            name="address_line_1"
            placeholder="Calle, número, colonia"
            required>
          </ion-textarea>
        </ion-item>

        <!-- Dirección línea 2 (opcional) -->
        <ion-item>
          <ion-label position="stacked">Dirección línea 2 (opcional)</ion-label>
          <ion-input
            [(ngModel)]="address.address_line_2"
            name="address_line_2"
            placeholder="Apartamento, suite, etc.">
          </ion-input>
        </ion-item>

        <!-- Ciudad -->
        <ion-item>
          <ion-label position="stacked">Ciudad *</ion-label>
          <ion-input
            [(ngModel)]="address.city"
            name="city"
            placeholder="Ciudad"
            required>
          </ion-input>
        </ion-item>

        <!-- Estado -->
        <ion-item>
          <ion-label position="stacked">Estado *</ion-label>
          <ion-input
            [(ngModel)]="address.state"
            name="state"
            placeholder="Estado"
            required>
          </ion-input>
        </ion-item>

        <!-- Código Postal -->
        <ion-item>
          <ion-label position="stacked">Código Postal *</ion-label>
          <ion-input
            [(ngModel)]="address.postal_code"
            name="postal_code"
            placeholder="Código postal"
            type="text"
            required>
          </ion-input>
        </ion-item>

        <!-- País -->
        <ion-item>
          <ion-label position="stacked">País *</ion-label>
          <ion-input
            [(ngModel)]="address.country"
            name="country"
            placeholder="País"
            required>
          </ion-input>
        </ion-item>

        <!-- Teléfono -->
        <ion-item>
          <ion-label position="stacked">Teléfono *</ion-label>
          <ion-input
            [(ngModel)]="address.phone"
            name="phone"
            placeholder="Número de teléfono"
            type="tel"
            required>
          </ion-input>
        </ion-item>


        <!-- Dirección predeterminada -->
        <ion-item>
          <ion-radio-group [(ngModel)]="address.is_default" name="is_default">
            <ion-radio slot="start" [value]="true"></ion-radio>
            <ion-label>Establecer como dirección predeterminada</ion-label>
          </ion-radio-group>
        </ion-item>

        <!-- Botones -->
        <div class="form-actions">
          <!-- Botón de debug temporal -->
          <ion-button
            expand="block"
            fill="outline"
            color="warning"
            (click)="debugForm()">
            Debug Formulario
          </ion-button>

          <ion-button
            expand="block"
            type="submit"
            [disabled]="!isFormValid() || saving">
            <ion-spinner *ngIf="saving" name="crescent" class="button-spinner"></ion-spinner>
            <span *ngIf="!saving">
              {{ isEditing ? 'Actualizar Dirección' : 'Guardar Dirección' }}
            </span>
          </ion-button>

          <ion-button
            expand="block"
            fill="outline"
            (click)="goBack()"
            [disabled]="saving">
            <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
            Cancelar
          </ion-button>
        </div>
      </form>
    </ion-card-content>
  </ion-card>
</ion-content>
